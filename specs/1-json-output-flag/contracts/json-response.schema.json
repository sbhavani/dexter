{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "DexterJsonResponse",
  "description": "JSON output produced by Dexter when invoked with the --json flag",
  "type": "object",
  "required": ["status", "query", "answer", "tools", "scratchpadFile", "metadata"],
  "additionalProperties": false,
  "properties": {
    "status": {
      "type": "string",
      "enum": ["success", "error"],
      "description": "Whether the query executed successfully"
    },
    "query": {
      "type": "string",
      "minLength": 1,
      "description": "The original user query"
    },
    "answer": {
      "type": "string",
      "description": "The final answer text. Empty string on error."
    },
    "tools": {
      "type": "array",
      "description": "Tools invoked during research",
      "items": {
        "type": "object",
        "required": ["name", "args", "result"],
        "additionalProperties": false,
        "properties": {
          "name": {
            "type": "string",
            "description": "Tool name"
          },
          "args": {
            "type": "object",
            "description": "Arguments passed to the tool"
          },
          "result": {
            "type": "string",
            "description": "Stringified tool result"
          }
        }
      }
    },
    "scratchpadFile": {
      "type": "string",
      "pattern": "^\\.dexter/scratchpad/.+\\.jsonl$",
      "description": "Relative path to the scratchpad JSONL file"
    },
    "metadata": {
      "type": "object",
      "required": ["model", "iterations", "totalTimeMs"],
      "additionalProperties": false,
      "properties": {
        "model": {
          "type": "string",
          "description": "Model ID used for the query"
        },
        "iterations": {
          "type": "integer",
          "minimum": 0,
          "description": "Agent loop iterations completed"
        },
        "totalTimeMs": {
          "type": "integer",
          "minimum": 0,
          "description": "Total wall-clock time in milliseconds"
        },
        "tokenUsage": {
          "type": "object",
          "required": ["inputTokens", "outputTokens", "totalTokens"],
          "additionalProperties": false,
          "properties": {
            "inputTokens": {
              "type": "integer",
              "minimum": 0
            },
            "outputTokens": {
              "type": "integer",
              "minimum": 0
            },
            "totalTokens": {
              "type": "integer",
              "minimum": 0
            }
          }
        }
      }
    },
    "error": {
      "type": "object",
      "required": ["code", "message"],
      "additionalProperties": false,
      "properties": {
        "code": {
          "type": "string",
          "enum": ["NO_QUERY", "AGENT_ERROR", "PROVIDER_ERROR", "CONFIG_ERROR", "UNKNOWN_ERROR"],
          "description": "Machine-readable error code"
        },
        "message": {
          "type": "string",
          "description": "Human-readable error description"
        }
      }
    }
  },
  "if": {
    "properties": { "status": { "const": "error" } }
  },
  "then": {
    "required": ["status", "query", "answer", "tools", "scratchpadFile", "metadata", "error"]
  }
}
